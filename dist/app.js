var c=(n,e,o)=>new Promise((a,r)=>{var i=t=>{try{m(o.next(t))}catch(d){r(d)}},s=t=>{try{m(o.throw(t))}catch(d){r(d)}},m=t=>t.done?a(t.value):Promise.resolve(t.value).then(i,s);m((o=o.apply(n,e)).next())});import{DynamoDB as l}from"@aws-sdk/client-dynamodb";import{Rekognition as y}from"@aws-sdk/client-rekognition";import{nanoid as p}from"nanoid";import{PrismaClient as u}from"@prisma/client";var I=new u;function N(o){return c(this,arguments,function*({bucketName:n,objectName:e}){let a=["Person","Knife","Gun","Weapon"];return new y().detectLabels({Image:{S3Object:{Bucket:n,Name:e}},MinConfidence:parseInt(process.env.REKOGNITION_MIN_CONFIDENCE||"80"),Settings:{GeneralLabels:{LabelInclusionFilters:a}}})})}function b(n){return c(this,null,function*(){return new l({region:"us-east-1"}).putItem({TableName:"lvb-analysis-payload",Item:{id:{S:p()},payload:{S:JSON.stringify(n)},insertedAt:{S:new Date().toISOString()}}})})}var f=n=>c(void 0,null,function*(){var i,s;yield b({event:n});let e=(s=(i=n.Records)==null?void 0:i[0])==null?void 0:s.s3;if(!e)throw new Error("No object info2");let{name:o}=e==null?void 0:e.bucket,{key:a}=e==null?void 0:e.object;if(!e)throw new Error("No object info2");let r=yield N({bucketName:o,objectName:a});return b({deviceCode:"device-1",rekognitionPayload:r})});f({name:"brun"});export{f as main};
